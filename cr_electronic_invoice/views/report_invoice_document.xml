<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="custom_header">

        <t t-set="report_date" t-value="o.invoice_date"/>
        <t t-set="report_number" t-value="int(o.name)"/>
        <t t-set="pre_printed_report" t-value="report_type == 'pdf'"/>
        <t t-set="report_name" t-value="o.tipo_documento"/>
        <t t-set="header_address" t-value="o.company_id.partner_id"/>
        <t t-set="custom_footer">
            <t t-call="cr_electronic_invoice.custom_footer"/>
        </t>

        <div>
            <div class="row">
                <div name="left-upper-side" class="col-8">
                    <strong>
                        <span t-field="o.company_id.partner_id.name"/>
                    </strong>
                    <br/>
                    <span name="company_activity" class="fst-italic" t-field="o.company_id.report_header"/>
                    <div/>
                    <div>
                        <strong>Cédula No.</strong>
                        <span t-field="o.company_id.partner_id.vat"/>
                        <br/>
                        <strong>Teléfono: </strong>
                        <span t-out="o.company_id.phone"/>
                        <br/>
                        <strong>Dirección: </strong>
                        <span t-out="o.company_id.partner_id._display_address(True)"/>
                        <br/>
                        <strong>Email: </strong>
                        <span t-out="o.company_id.email"/>
                        <br/>
                        <strong>Actividad Económica: </strong>
                        <span t-out="o.company_id.activity_id.code"/>
                        <br/>
                    </div>
                </div>
                <div name="right-upper-side" class="col-4">
                    <div class="row">
                        <div name="right-upper-side" class="col-12">
                            <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)"
                                 style="max-height: 45px;" alt="Logo"/>
                            <br/>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </template>

    <template id="custom_footer">
        <div name="footer_left_column" class="col-8 text-center"/>
    </template>
    <!-- Legally required data & barcode (re-used by withhold report) -->
    <template id="report_invoice_header">
        <table class="table table-borderless w-100 m-1">
            <tr>
                <td class="pe-1" style="width: 30%">
                    <table class="table table-borderless">
                        <tr>
                            <td class="text-center p-1">
                                <h4 style="letter-spacing: 2px;">
                                    <span t-field="o.company_id.name"/>
                                </h4>
                                <div style="font-size: 12px;">
                                    <strong>
                                        Cédula No.
                                    </strong>
                                    <span t-field="o.company_id.partner_id.vat"/>
                                    <br/>
                                    <strong>Teléfono: </strong>
                                    <span t-esc="o.company_id.phone"/>
                                    <br/>
                                    <strong>Dirección: </strong>
                                    <span t-esc="o.company_id.street"/>
                                    <br/>
                                    <strong>Email: </strong>
                                    <span t-esc="o.company_id.email"/>
                                    <br/>
                                    <strong>Actividad Económica: </strong>
                                    <span t-esc="o.company_id.activity_id.name"/>
                                    <br/>
                                </div>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </template>

    <template id="report_invoice_document" inherit_id="account.report_invoice_document">

        <xpath expr="//t/div[@class='mt-5 clearfix']" position="attributes">
             <attribute name="class">clearfix</attribute>
        </xpath>

        <!--        reemplazar custom header-->
        <t t-set="o" position="after">
            <t t-set="custom_header" t-value="'cr_electronic_invoice.custom_header'"/>
        </t>


        <!-- Remove the partner address -->
        <xpath expr="//div[@name='address_not_same_as_shipping']" position="replace">
            <div name="address_not_same_as_shipping"/>
        </xpath>
        <xpath expr="//div[@name='address_same_as_shipping']" position="replace">
            <div name="address_same_as_shipping"/>
        </xpath>
        <xpath expr="//div[@name='no_shipping']" position="replace">
            <div name="no_shipping"/>
        </xpath>

        <!-- Add a few extra items to Informations (and rename a field) -->
        <xpath expr="//div[@id='informations']" position="replace">
            <div id="informations" class="row mt-3 mb-1">
                <div class="col-6 mw-100 mb-2">
                    <strong>Clave Númerica:</strong>
                    <p class="m-0" t-out="o.number_electronic"/>
                </div>
                <div class="col-3 mw-100 mb-2">
                    <strong>Tipo Documento:</strong>
                    <p class="m-0" t-field="o.tipo_documento"/>
                </div>
                <div class="col-3 mw-100 mb-2">
                    <strong>Fecha:</strong>
                    <p class="m-0" t-field="o.date_issuance"/>
                </div>
            </div>
            <div id="informations_2" class="row mt-3 mb-1">
                <div class="col-3 mw-100 mb-2">
                    <strong>Métodos de pagos:</strong>
                    <p class="m-0" t-out="o.payment_methods_id.name"/>
                </div>
                <div class="col-3 mw-100 mb-2">
                    <strong>Condición:</strong>
                    <p class="m-0" t-field="o.invoice_payment_term_id.name"/>
                </div>
            </div>
            <div id="receptor_line1" class="row mt-3 mb-1">
                <div class="col-6 mb-2 mw-100">
                    <strong>Razón Social:</strong><br/>
                    <span t-field="o.partner_id.name"/>
                </div>
                <div class="col-3 mb-2 mw-100">
                    <strong>Cédula No.:</strong><br/>
                    <span t-field="o.partner_id.vat"/>
                </div>
                <div class="col-3 mb-2 mw-100">
                    <strong>Teléfono:</strong><br/>
                    <span t-field="o.partner_id.phone"/>
                </div>
            </div>
            <div id="receptor_line2" class="row mt-3 mb-1">
                <div class="col-4 mb-2 mw-100">
                    <strong>Email:</strong><br/>
                    <span t-field="o.partner_id.email"/>
                </div>
                <div class="col-8 mb-2 mw-100">
                    <strong>Dirección:</strong><br/>
                    <span t-out="o.partner_id._display_address()"/>
                </div>
            </div>
        </xpath>

        <!--        CODIGO CABYS-->
        <xpath expr="//table[@name='invoice_line_table']/thead/tr[1]/th[1]" position="before">
            <th name="th_cabys_cod" class="text-start">
                <span>CABYS</span>
            </th>
        </xpath>
        <xpath expr="//table[@name='invoice_line_table']/tbody//tr[1]//td[1]" position="before">
            <td name="td_auxiliary_code">
                <span t-esc="line.product_id.cabys_code or ''"/>
            </td>
        </xpath>

        <!--        leyenda final -->
        <xpath expr="//t/div[2]/div/div[last()]" position="after">
            <p class="text-center">
                <span>Autorizada mediante resolución N° DGT-R-033-2019 del 20 de junio de 2019.</span>
                <br></br>
                <span>FE Version 4.3</span>
            </p>
        </xpath>
    </template>
</odoo>
